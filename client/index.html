<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="index.css">
    <script src="sigma-bundle.js"></script>
    <script src="bundle.js"></script>
    <script src="native.js"></script>
    <script src="ui-builder/index.js"></script>
</head>

<body style="margin: 0px auto; padding: 0px">

    <div id="root" style="width: 100%; height: 100%; overflow: hidden;">

    </div>

    <script type="module">
        
        let root = document.getElementById('root')
        let { Applet, Controls, Utils } = window.engine
        let uiDriver = new UIDriver(Utils.compiler.styleToCssString)

        let applet = new Applet('frame')
        fetch('/Menu.jsx').then(res => res.text()).then(code => {
            applet.fill(code)
            const update = (key, updates) => {
                console.log(Utils.json.prettify(updates))
                updates.forEach(u => {
                    if (u.__action__ === 'element_deleted') {
                        uiDriver.deleteChild(u.__key__)
                    } else if (u.__action__ === 'element_created') {
                        uiDriver.createChild(u.__element__, u.__parentKey__)
                    } else if (u.__action__ === 'props_updated') {
                        Object.keys(u.__updated__).forEach(propKey => {
                            uiDriver.updateProp(u.__key__, propKey, u.__updated__[propKey]._value)
                        })
                    } else if (u.__action__ === 'styles_updated') {
                        Object.keys(u.__updated__).forEach(styleKey => {
                            uiDriver.updateStyle(u.__key__, styleKey, u.__updated__[styleKey])
                        })
                    }
                });
            }
            applet.run('Test', mod => new Native(mod, Controls), update).then(runnable => {
                console.log(Utils.json.prettify(runnable.root))
                let ui = uiDriver.build(runnable.root)
                root.appendChild(ui)
                runnable.mount()
            })
        })
    </script>

</body>


</html>