<html>

<head>
    <script src="engine/bundle.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="./ui-builder/index.js"></script>
    <script src="./bundle.js"></script>
</head>

<body style="margin: 0px auto; padding: 0px">

    <div id="root" style="width: 100%; height: 100vh;">

    </div>

</body>

<script>

    let root = document.getElementById('root')

    let { Applet, Native, Utils } = window.engine

    let uiDriver = new UIDriver()

    let applet = new Applet('frame')
    applet.fill(
        {"type":"Program","start":0,"end":1198,"body":[{"type":"ClassDeclaration","start":5,"end":1197,"id":{"type":"Identifier","start":11,"end":17,"name":"Button"},"superClass":null,"body":{"type":"ClassBody","start":18,"end":1197,"body":[{"type":"MethodDefinition","start":28,"end":148,"static":false,"computed":false,"key":{"type":"Identifier","start":28,"end":39,"name":"constructor"},"kind":"constructor","value":{"type":"FunctionExpression","start":39,"end":148,"id":null,"expression":false,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","start":42,"end":148,"body":[{"type":"ExpressionStatement","start":56,"end":138,"expression":{"type":"AssignmentExpression","start":56,"end":138,"operator":"=","left":{"type":"MemberExpression","start":56,"end":66,"object":{"type":"ThisExpression","start":56,"end":60},"property":{"type":"Identifier","start":61,"end":66,"name":"state"},"computed":false,"optional":false},"right":{"type":"ObjectExpression","start":69,"end":138,"properties":[{"type":"Property","start":87,"end":96,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":87,"end":92,"name":"items"},"value":{"type":"ArrayExpression","start":94,"end":96,"elements":[]},"kind":"init"},{"type":"Property","start":114,"end":124,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":114,"end":121,"name":"counter"},"value":{"type":"Literal","start":123,"end":124,"value":0,"raw":"0"},"kind":"init"}]}}}]}}},{"type":"MethodDefinition","start":157,"end":368,"static":false,"computed":false,"key":{"type":"Identifier","start":157,"end":164,"name":"onMount"},"kind":"method","value":{"type":"FunctionExpression","start":164,"end":368,"id":null,"expression":false,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","start":167,"end":368,"body":[{"type":"ExpressionStatement","start":181,"end":358,"expression":{"type":"CallExpression","start":181,"end":358,"callee":{"type":"Identifier","start":181,"end":192,"name":"setInterval"},"arguments":[{"type":"ArrowFunctionExpression","start":193,"end":351,"id":null,"expression":false,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","start":199,"end":351,"body":[{"type":"ExpressionStatement","start":217,"end":237,"expression":{"type":"UpdateExpression","start":217,"end":237,"operator":"++","prefix":false,"argument":{"type":"MemberExpression","start":217,"end":235,"object":{"type":"MemberExpression","start":217,"end":227,"object":{"type":"ThisExpression","start":217,"end":221},"property":{"type":"Identifier","start":222,"end":227,"name":"state"},"computed":false,"optional":false},"property":{"type":"Identifier","start":228,"end":235,"name":"counter"},"computed":false,"optional":false}}},{"type":"ExpressionStatement","start":254,"end":295,"expression":{"type":"CallExpression","start":254,"end":295,"callee":{"type":"MemberExpression","start":254,"end":275,"object":{"type":"MemberExpression","start":254,"end":270,"object":{"type":"MemberExpression","start":254,"end":264,"object":{"type":"ThisExpression","start":254,"end":258},"property":{"type":"Identifier","start":259,"end":264,"name":"state"},"computed":false,"optional":false},"property":{"type":"Identifier","start":265,"end":270,"name":"items"},"computed":false,"optional":false},"property":{"type":"Identifier","start":271,"end":275,"name":"push"},"computed":false,"optional":false},"arguments":[{"type":"MemberExpression","start":276,"end":294,"object":{"type":"MemberExpression","start":276,"end":286,"object":{"type":"ThisExpression","start":276,"end":280},"property":{"type":"Identifier","start":281,"end":286,"name":"state"},"computed":false,"optional":false},"property":{"type":"Identifier","start":287,"end":294,"name":"counter"},"computed":false,"optional":false}],"optional":false}},{"type":"ExpressionStatement","start":312,"end":337,"expression":{"type":"CallExpression","start":312,"end":337,"callee":{"type":"MemberExpression","start":312,"end":325,"object":{"type":"ThisExpression","start":312,"end":316},"property":{"type":"Identifier","start":317,"end":325,"name":"setState"},"computed":false,"optional":false},"arguments":[{"type":"MemberExpression","start":326,"end":336,"object":{"type":"ThisExpression","start":326,"end":330},"property":{"type":"Identifier","start":331,"end":336,"name":"state"},"computed":false,"optional":false}],"optional":false}}]}},{"type":"Literal","start":353,"end":357,"value":1000,"raw":"1000"}],"optional":false}}]}}},{"type":"MethodDefinition","start":377,"end":1191,"static":false,"computed":false,"key":{"type":"Identifier","start":377,"end":383,"name":"render"},"kind":"method","value":{"type":"FunctionExpression","start":383,"end":1191,"id":null,"expression":false,"generator":false,"async":false,"params":[],"body":{"type":"BlockStatement","start":386,"end":1191,"body":[{"type":"ReturnStatement","start":400,"end":1181,"argument":{"type":"JSXElement","start":425,"end":1167,"openingElement":{"type":"JSXOpeningElement","start":425,"end":532,"attributes":[{"type":"JSXAttribute","start":430,"end":531,"name":{"type":"JSXIdentifier","start":430,"end":435,"name":"style"},"value":{"type":"JSXExpressionContainer","start":436,"end":531,"expression":{"type":"ObjectExpression","start":437,"end":530,"properties":[{"type":"Property","start":439,"end":462,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":439,"end":454,"name":"backgroundColor"},"value":{"type":"Literal","start":456,"end":462,"value":"#eee","raw":"'#eee'"},"kind":"init"},{"type":"Property","start":464,"end":477,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":464,"end":469,"name":"width"},"value":{"type":"Literal","start":471,"end":477,"value":"100%","raw":"'100%'"},"kind":"init"},{"type":"Property","start":479,"end":493,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":479,"end":485,"name":"height"},"value":{"type":"Literal","start":487,"end":493,"value":"100%","raw":"'100%'"},"kind":"init"},{"type":"Property","start":495,"end":510,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":495,"end":502,"name":"display"},"value":{"type":"Literal","start":504,"end":510,"value":"flex","raw":"'flex'"},"kind":"init"},{"type":"Property","start":512,"end":528,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":512,"end":520,"name":"flexWrap"},"value":{"type":"Literal","start":522,"end":528,"value":"wrap","raw":"'wrap'"},"kind":"init"}]}}}],"name":{"type":"JSXIdentifier","start":426,"end":429,"name":"box"},"selfClosing":false},"closingElement":{"type":"JSXClosingElement","start":1161,"end":1167,"name":{"type":"JSXIdentifier","start":1163,"end":1166,"name":"box"}},"children":[{"type":"JSXText","start":532,"end":553,"value":"\n                    ","raw":"\n                    "},{"type":"JSXExpressionContainer","start":553,"end":1144,"expression":{"type":"CallExpression","start":579,"end":1122,"callee":{"type":"MemberExpression","start":579,"end":599,"object":{"type":"MemberExpression","start":579,"end":595,"object":{"type":"MemberExpression","start":579,"end":589,"object":{"type":"ThisExpression","start":579,"end":583},"property":{"type":"Identifier","start":584,"end":589,"name":"state"},"computed":false,"optional":false},"property":{"type":"Identifier","start":590,"end":595,"name":"items"},"computed":false,"optional":false},"property":{"type":"Identifier","start":596,"end":599,"name":"map"},"computed":false,"optional":false},"arguments":[{"type":"ArrowFunctionExpression","start":600,"end":1121,"id":null,"expression":false,"generator":false,"async":false,"params":[{"type":"Identifier","start":600,"end":604,"name":"item"}],"body":{"type":"BlockStatement","start":608,"end":1121,"body":[{"type":"ReturnStatement","start":638,"end":1095,"argument":{"type":"JSXElement","start":679,"end":1065,"openingElement":{"type":"JSXOpeningElement","start":679,"end":718,"attributes":[{"type":"JSXAttribute","start":685,"end":695,"name":{"type":"JSXIdentifier","start":685,"end":688,"name":"key"},"value":{"type":"JSXExpressionContainer","start":689,"end":695,"expression":{"type":"Identifier","start":690,"end":694,"name":"item"}}},{"type":"JSXAttribute","start":696,"end":717,"name":{"type":"JSXIdentifier","start":696,"end":701,"name":"style"},"value":{"type":"JSXExpressionContainer","start":702,"end":717,"expression":{"type":"ObjectExpression","start":703,"end":716,"properties":[{"type":"Property","start":705,"end":714,"method":false,"shorthand":false,"computed":false,"key":{"type":"Identifier","start":705,"end":711,"name":"margin"},"value":{"type":"Literal","start":713,"end":714,"value":8,"raw":"8"},"kind":"init"}]}}}],"name":{"type":"JSXIdentifier","start":680,"end":684,"name":"card"},"selfClosing":false},"closingElement":{"type":"JSXClosingElement","start":1058,"end":1065,"name":{"type":"JSXIdentifier","start":1060,"end":1064,"name":"card"}},"children":[{"type":"JSXText","start":718,"end":755,"value":"\n                                    ","raw":"\n                                    "},{"type":"JSXElement","start":755,"end":1025,"openingElement":{"type":"JSXOpeningElement","start":755,"end":761,"attributes":[],"name":{"type":"JSXIdentifier","start":756,"end":760,"name":"tabs"},"selfClosing":false},"closingElement":{"type":"JSXClosingElement","start":1018,"end":1025,"name":{"type":"JSXIdentifier","start":1020,"end":1024,"name":"tabs"}},"children":[{"type":"JSXText","start":761,"end":802,"value":"\n                                        ","raw":"\n                                        "},{"type":"JSXElement","start":802,"end":834,"openingElement":{"type":"JSXOpeningElement","start":802,"end":815,"attributes":[],"name":{"type":"JSXIdentifier","start":803,"end":814,"name":"primary-tab"},"selfClosing":false},"closingElement":{"type":"JSXClosingElement","start":820,"end":834,"name":{"type":"JSXIdentifier","start":822,"end":833,"name":"primary-tab"}},"children":[{"type":"JSXText","start":815,"end":820,"value":"Video","raw":"Video"}]},{"type":"JSXText","start":834,"end":875,"value":"\n                                        ","raw":"\n                                        "},{"type":"JSXElement","start":875,"end":908,"openingElement":{"type":"JSXOpeningElement","start":875,"end":888,"attributes":[],"name":{"type":"JSXIdentifier","start":876,"end":887,"name":"primary-tab"},"selfClosing":false},"closingElement":{"type":"JSXClosingElement","start":894,"end":908,"name":{"type":"JSXIdentifier","start":896,"end":907,"name":"primary-tab"}},"children":[{"type":"JSXText","start":888,"end":894,"value":"Photos","raw":"Photos"}]},{"type":"JSXText","start":908,"end":949,"value":"\n                                        ","raw":"\n                                        "},{"type":"JSXElement","start":949,"end":981,"openingElement":{"type":"JSXOpeningElement","start":949,"end":962,"attributes":[],"name":{"type":"JSXIdentifier","start":950,"end":961,"name":"primary-tab"},"selfClosing":false},"closingElement":{"type":"JSXClosingElement","start":967,"end":981,"name":{"type":"JSXIdentifier","start":969,"end":980,"name":"primary-tab"}},"children":[{"type":"JSXText","start":962,"end":967,"value":"Audio","raw":"Audio"}]},{"type":"JSXText","start":981,"end":1018,"value":"\n                                    ","raw":"\n                                    "}]},{"type":"JSXText","start":1025,"end":1058,"value":"\n                                ","raw":"\n                                "}]}}]}}],"optional":false}},{"type":"JSXText","start":1144,"end":1161,"value":"\n                ","raw":"\n                "}]}}]}}}]}}],"sourceType":"module"}   
    )

    let uiRoot

    const crawl = (newEl, oldEl) => {
        if (newEl._props) {
            for (let propKey in newEl._props) {
                if (newEl._props[propKey]._value?.__state__ === 'updated' || newEl._props[propKey]._value?.__state__ === 'updated') {
                    let newValue = newEl._props[propKey]._value.__value__
                    oldEl._props[propKey] = { _value: newValue, _defaultValue: oldEl._props[propKey]._defaultValue, _type: oldEl._props[propKey]._type }
                    uiDriver.update(oldEl, propKey, newValue)
                } else if (newEl._props[propKey]._value?.__state__ === 'deleted') {
                    delete oldEl._props[propKey]
                }
            }
        }
        if (newEl._children) {
            if (newEl._children.__state__ === 'created') {
                oldEl._children = newEl._children.__value__
            } else {
                for (let arrayIndex in newEl._children) {
                    let child = newEl._children[Number(arrayIndex)]
                    if (child.__state__ === 'created') {
                        oldEl._children[Number(arrayIndex)] = child.__value__
                        uiDriver.build(child.__value__, oldEl._key)
                    }
                }
                for (let child in newEl._children) {
                    crawl(child,)
                }
            }
        }
    }

    const update = (u) => {
        console.log(Utils.json.prettify(u))
        crawl(u, uiRoot)
    }

    applet.run('Button', (mod) => new Native(mod), update).then((runnable) => {
        console.log(Utils.json.prettify(runnable.root))
        uiRoot = runnable.root
        let ui = uiDriver.build(runnable.root)
        root.appendChild(ui)
        runnable.mount()
    })

</script>

</html>